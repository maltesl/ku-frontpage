% ku-frontpage.sty
%------------------------------------------------------------------------------
% Copyright (c) 2021 by M.O.Larsen.
% Copyright (c) 2021 Malte Leip <malte@leip.net>
%
% Distributed under the terms of the MIT License:
% -----------------------------------------------------------------------------
% Permission is hereby granted, free of charge, to any person obtaining a copy
% of this software and associated documentation files (the "Software"), to deal
% in the Software without restriction, including without limitation the rights
% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the Software is
% furnished to do so, subject to the following conditions:
%
% The above copyright notice and this permission notice shall be included in
% all copies or substantial portions of the Software.
%
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
% SOFTWARE.
% -----------------------------------------------------------------------------
%
%
% LaTeX style for front pages adhering to University of Copenhagen's design
% guide (http://designguide.ku.dk/) for SCIENCE and SUND faculty, and main
% KU-style.
%
% Original author:
%   Mads Ohm Larsen <mads@ohmbrix.dk>
%
% Inspired by Christian Aastrups package 'ku-forside' from 2007
% (http://www.math.ku.dk/~m00cha/), however translated all call to their
% English equivalant and included newer logos.
%
% Layout of the titlepage variant inspired by Joshua Hunt's PhD thesis.
%------------------------------------------------------------------------------
\ProvidesPackage{ku-frontpage}[2018/12/06 v0.5 Frontpages with University of Copenhagen logos]

%%% Define 'if''s for style.
\newif\if@kutitlepage\@kutitlepagefalse \DeclareOption{titlepage}{\@kutitlepagetrue}
\newif\if@kusmall\@kusmallfalse         \DeclareOption{small}{\@kusmalltrue}
\newif\if@kularge\@kulargefalse         \DeclareOption{large}{\@kulargetrue}

%%% Define 'if''s for language.
\newif\if@kuenglish                     \DeclareOption{english}{\@kuenglishtrue}
\newif\if@kudanish                      \DeclareOption{danish}{\@kudanishtrue}

%%% Define 'if''s for faculties.
\newif\if@science                       \DeclareOption{science}{\@sciencetrue}
\newif\if@sund                          \DeclareOption{sund}{\@sundtrue}
\newif\if@ku                            \DeclareOption{ku}{\@kutrue}

%%% Define 'if' for submission statement as required by PhD regulations.
\newif\if@submissionstatement\@submissionstatementfalse
\DeclareOption{submissionstatement}{\@submissionstatementtrue}

%%% Define 'if''s for other things.
\newif\if@hyperref                      \DeclareOption{hyperref}{\@hyperreftrue}
\newif\if@dropcaps                      \DeclareOption{dropcaps}{\@dropcapstrue}

%%% Warning about unknown options
\DeclareOption*{
  \ClassWarning{ku-frontpage}{Unknown option '\CurrentOption'}
}

%%% Define standard values.
\ExecuteOptions{titlepage}
\ExecuteOptions{english}
\ExecuteOptions{science}

%%% No more options.
\ProcessOptions\relax

%%% Parse options.
\if@kutitlepage \def\KUSTYLE{titlepage} \fi
\if@kusmall     \def\KUSTYLE{small}     \fi
\if@kularge     \def\KUSTYLE{large}     \fi

\if@kuenglish   \def\KULANG{english}    \fi
\if@kudanish    \def\KULANG{danish}     \fi

\if@science     \def\KUFACULTY{science} \fi
\if@sund        \def\KUFACULTY{sund}    \fi
\if@ku          \def\KUFACULTY{ku}      \fi

%%% Some packages are required for this package.
\RequirePackage{eso-pic}
\RequirePackage{graphicx}
\RequirePackage{ifthen}
\RequirePackage{etoolbox}

\definecolor{KU}{HTML}{901A1E}
\definecolor{KUscience}{HTML}{46743C}
\definecolor{KUsund}{HTML}{2A216A}

%%% Since 2020 the red KU-logo and color should be used rather than
%%% faculty logos and colors.
\def\KUCOLOR{KU}

%%% Define the page to have 12 horizontal modules and 24 vertical modules.
\RequirePackage[absolute]{textpos}
\TPGrid{12}{24}

%%% Define custom methods for frontpage.
\def\ASSIGNMENT{Use \texttt{$\backslash$assignment$\lbrace \ldots \rbrace$}}
\def\AUTHOR{Use \texttt{$\backslash$author$\lbrace \ldots \rbrace$}}
\def\TITLE{Use \texttt{$\backslash$title$\lbrace \ldots \rbrace$}}
\def\SUBTITLE{Use \texttt{$\backslash$subtitle$\lbrace \ldots \rbrace$}}
\def\ADVISOR{Use \texttt{$\backslash$advisor$\lbrace \ldots \rbrace$}}
\def\DATE{Use \texttt{$\backslash$date$\lbrace \ldots \rbrace$}}
\def\FRONTPAGEIMAGE{}

%%% Construct the correct submission statement.
\if@submissionstatement
  \def\SUBMISSIONSTATEMENT{
    Use \texttt{$\backslash$submissionstatement$\lbrace \ldots \rbrace$}
  }
  \if@science
    % See https://www.science.ku.dk/phd/rules/
    % Section 5.1 of the rules, under "Formal requirements to the PhD thesis"
    \def\SUBMISSIONSTATEMENT{%
      This thesis has been submitted to
      the PhD School of The Faculty of Science, University of Copenhagen%
    }
  \fi
  \if@sund
    % See https://healthsciences.ku.dk/phd/guidelines/
    % Section 5.1 of the rules, under "Specific requirements"
    \def\SUBMISSIONSTATEMENT{%
      This thesis has been submitted to the Graduate School
      of the Faculty of Health and Medical Sciences,\\ University of Copenhagen%
    }
  \fi
\else
  \def\SUBMISSIONSTATEMENT{}
\fi

%%% Make sure the commands we want to patch exist.
%%% For example, some classes (like scrbook) define \subtitle, others do not.
\providecommand{\author}[1]{}
\providecommand{\title}[1]{}
\providecommand{\date}[1]{}
\providecommand{\assignment}[1]{}
\providecommand{\subtitle}[1]{}
\providecommand{\advisor}[1]{}
\providecommand{\frontpageimage}[1]{}
\providecommand{\submissionstatement}{}

%%% Patch commands
\pretocmd{\author}{\def\AUTHOR{#1}}{}{\PackageError{ku-frontpage}{Tried to patch author command, but failed.}{}}
\pretocmd{\title}{\def\TITLE{#1}}{}{\PackageError{ku-frontpage}{Tried to patch title command, but failed.}{}}
\pretocmd{\date}{\def\DATE{#1}}{}{\PackageError{ku-frontpage}{Tried to patch date command, but failed.}{}}
\pretocmd{\assignment}{\def\ASSIGNMENT{#1}}{}{\PackageError{ku-frontpage}{Tried to patch assignment command, but failed.}{}}
\pretocmd{\subtitle}{\def\SUBTITLE{#1}}{}{\PackageError{ku-frontpage}{Tried to patch subtitle command, but failed.}{}}
\pretocmd{\advisor}{\def\ADVISOR{#1}}{}{\PackageError{ku-frontpage}{Tried to patch advisor command, but failed.}{}}
\pretocmd{\frontpageimage}{\def\FRONTPAGEIMAGE{#1}}{}{\PackageError{ku-frontpage}{Tried to patch frontpageimage command, but failed.}{}}
\pretocmd{\submissionstatement}{\def\SUBMISSIONSTATEMENT{#1}}{}{\PackageError{ku-frontpage}{Tried to patch submissionstatement command, but failed.}{}}

%%% Include hyperref for PDF attributes.
\if@hyperref
  \RequirePackage{hyperref}
  \newcommand{\kupdfsetup}[3]{
    \hypersetup{
      pdftitle={#1},
      pdfsubject={#2},
      pdfauthor={#3},
      colorlinks=true,
      citecolor={\KUCOLOR},
      linkcolor={\KUCOLOR},
      urlcolor={\KUCOLOR},
    }
  }
\fi

%%% Define drop caps
\if@dropcaps
  \RequirePackage{lettrine}

  \renewcommand\LettrineFontHook{\color{\KUCOLOR}}
  \renewcommand{\DefaultOptionsFile}{NoFileOnPurposeHack.cfg}

  \LettrineOptionsFor{A}{loversize= 0.05,lhang= 0.10,findent= 0.000\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{B}{loversize= 0.10,lhang= 0.30,findent= 0.025\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{C}{loversize= 0.00,lhang= 0.15,findent= 0.175\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{D}{loversize= 0.10,lhang= 0.30,findent=-0.025\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{E}{loversize= 0.10,lhang= 0.10,findent= 0.100\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{F}{loversize= 0.10,lhang= 0.30,findent= 0.100\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{G}{loversize=-0.08,lhang= 0.10,findent= 0.000\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{H}{loversize=-0.01,lhang= 0.00,findent= 0.040\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{I}{loversize= 0.10,lhang= 0.00,findent= 0.050\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{J}{loversize=-0.08,lhang= 0.00,findent=-0.025\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{K}{loversize=-0.05,lhang= 0.00,findent=-0.050\LettrineWidth,nindent= 0.60\LettrineWidth}
  \LettrineOptionsFor{L}{loversize= 0.00,lhang= 0.00,findent= 0.100\LettrineWidth,nindent= 0.40\LettrineWidth}
  \LettrineOptionsFor{M}{loversize= 0.10,lhang= 0.40,findent= 0.040\LettrineWidth,nindent= 0.10\LettrineWidth}
  \LettrineOptionsFor{N}{loversize= 0.00,lhang= 0.20,findent=-0.010\LettrineWidth,nindent= 0.40\LettrineWidth}
  \LettrineOptionsFor{O}{loversize= 0.10,lhang= 0.20,findent=-0.010\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{P}{loversize= 0.10,lhang= 0.30,findent= 0.050\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{Q}{loversize= 0.00,lhang= 0.20,findent= 0.050\LettrineWidth,nindent= 0.70\LettrineWidth}
  \LettrineOptionsFor{R}{loversize=-0.05,lhang= 0.25,nindent= 0.500\LettrineWidth,nindent= 0.50\LettrineWidth}
  \LettrineOptionsFor{S}{loversize= 0.10,lhang= 0.00,findent= 0.000\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{T}{loversize= 0.10,lhang= 0.35,findent= 0.100\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{U}{loversize= 0.10,lhang= 0.20,findent= 0.050\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{V}{loversize= 0.10,lhang= 0.40,findent= 0.050\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{W}{loversize= 0.10,lhang= 0.30,findent= 0.040\LettrineWidth,nindent= 0.50em}
  \LettrineOptionsFor{X}{loversize= 0.10,lhang= 0.40,findent= 0.040\LettrineWidth,nindent= 0.20\LettrineWidth}
  \LettrineOptionsFor{Y}{loversize= 0.10,lhang= 0.20,findent= 0.100\LettrineWidth,nindent= 0.20\LettrineWidth}
  \LettrineOptionsFor{Z}{loversize=-0.05,lhang= 0.00,findent= 0.050\LettrineWidth,nindent= 0.55\LettrineWidth}
\fi

%%% Define the three types of frontpage
\if@kutitlepage
  \def\KUbold{\fontseries{bx}\selectfont}
  \def\KUsemibold{\fontseries{sb}\selectfont}

  \def\maketitle{
    \thispagestyle{empty}
    \AddToShipoutPicture*{\put( 0, -35){\includegraphics*{logos/ku-logo}}}
    \AddToShipoutPicture*{\put(-8,   8){\includegraphics*{logos/\KUFACULTY-\KULANG}}}

    \ifthenelse{\equal{\FRONTPAGEIMAGE}{}}{}{
      \AddToShipoutPicture*{
        \AtPageUpperLeft{\raisebox{-185mm}{\hspace{55pt}\includegraphics*[width=\textwidth, height=100mm, keepaspectratio]{\FRONTPAGEIMAGE}}}
      }
    }

    \begin{textblock}{10}(1.14, 15.9)
      \noindent\fontsize{16pt}{18pt}\KUsemibold\ASSIGNMENT
    \end{textblock}

    \begin{textblock}{10}(1.14, 16.9)
      \noindent\fontsize{28pt}{30pt}\KUsemibold\TITLE
      \par\vspace{2mm}
      \noindent\fontsize{14pt}{16pt}\KUsemibold\SUBTITLE
      \par\vspace{4mm}
      \noindent\fontsize{16pt}{18pt}\KUsemibold\AUTHOR
    \end{textblock}

    \begin{textblock}{10}(1.14, 20.5)
      \begingroup
        \fontsize{11pt}{12pt}\KUsemibold
        \noindent\ADVISOR
        \par\vspace{4mm}
        \noindent\DATE
      \endgroup
      \par\vspace{4mm}
      \fontsize{11pt}{12pt}
      \noindent\SUBMISSIONSTATEMENT
    \end{textblock}

    \phantom{...}
    \newpage
    \noindent
  }
\fi

\if@kusmall
  \def\maketitle{
    \thispagestyle{plain}
    \AddToShipoutPicture*{\put(35,  83){\includegraphics*[scale=0.88]{logos/ku-logo}}}
    \begin{textblock}{10}(1.59, 2.32)
      \noindent\large{\textbf{\TITLE}}
      \par\vspace{3.2mm}
      \noindent\normalsize{\SUBTITLE}
      \par\vspace{2mm}
      \noindent\small{\emph{\AUTHOR}}
      \par\vspace{1.3mm}
      \noindent\scriptsize{\DATE}
    \end{textblock}
    \phantom{...}
    \vspace*{3.2cm}
    \noindent
  }
\fi

\if@kularge
  \def\maketitle{
    \thispagestyle{plain}
    \AddToShipoutPicture*{\put(-220, -310){\includegraphics*[scale=1.4]{logos/ku-logo}}}
    \begin{textblock}{10}(1.59, 2.22)
      \noindent\LARGE{\textbf{\TITLE}}
      \par\vspace{4mm}
      \noindent\Large{\SUBTITLE}
      \par\vspace{5mm}
      \noindent\normalsize{\emph{\AUTHOR}}
      \par\vspace{5mm}
      \noindent\footnotesize{\DATE}
    \end{textblock}
    \phantom{...}
    \vspace*{5cm}
    \noindent
  }
\fi
